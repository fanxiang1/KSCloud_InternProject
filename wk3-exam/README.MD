# 星云训练营 - 第三周作业 - 微服务

作业细节见: https://kingsoft-cloud.feishu.cn/docx/CfKOdC79moeDkYxRQc4cgy55n6e

将此模板代码用作你的作业，作为代码基础 
然后创建你自己的仓库，仓库名称统一为 wk3-exam  
例如你叫张三，正确的仓库地址看起来是这样的 http://120.92.88.48/zhangsan/wk3-exam  
代码统一提交到 main 分支

**注意，切记将可见级别 （Visibility Level ） 设置为 私有 （private） 如果你的作业给人抄了，你们有可能一起被淘汰**

## registry注册中心

实现一个简单服务注册中心 (register)。其服务端口为 8180

思路：使用ConcurrentHashMap存储服务相关信息。key为服务名，value为一个list，为传过来的信息封装的对象类

register：

1）首先根据服务名查询是否存在该服务，若服务不存在，则进行注册，new一个list将传过来的数据加上时间字段封装成对象放进去，再将list放入ConcurrentHashMap中

2）若存在该服务，但对应的list中没有该服务实例，将其添加到对应的list中，更新map。

3）若该实例已经存在了，则返回提示“不可重复注册同一服务”，否则返回”服务注册成功“

unregister:

1)首先根据服务名查询是否存在该服务，若服务不存在,则返回提示"该服务不在注册中心中,请检查"

2）如果存在该服务，需要去注销完全符合的那个实例，进入对应的list中，找到list中和要注销的服务的字段完全相同的对象进行删除

heartbeat:

1）将传过来的对象和map中的list进行全字段比对，找到符合的服务，更新其beatTime字段。

discovery：

1）如果没有带参数，输出全部的数据

2）如果带了参数，使用标准轮询时间输出一个服务节点信息，为了保险，此处再进行一次心跳时间超过60s删除服务的校验，保证返回的服务可用。

注册中心每60秒执行一次定时任务，检查map中是否有超过60秒未发送心跳的服务，有的话进行删除

## 时间服务端

实现一个简单时间服务 (服务名 time-service)，此服务在运行时有2个实例，其服务端口分别为 8280，8281

getDateTime

1）获取时间、根据参数格式化格式化时间、选择GMT时区，返回信息。

此服务开启时执行注册并发送心跳，之后每隔60秒发送一次心跳，结束前发送注销请求。

## 客户端

实现一个服务客户端 (服务名 client)，此服务在运行时有2个实例，其服务端口为 8300, 8301。它调用 2 所述的简单时间服务中的接口，然后进行相关处理，将处理结果通过 API 供其他应用使用

1）先向注册中心获取远端服务列表，注册中心会返回一个可用的服务实例,然后执行远端调用方法得到时间

2）将GMT时间转为北京时间并进行封装，返回json对象

运行时客户端每1秒向日志收集服务端写入一条日志，其包含客户端服务名称、客户端实例ID，时间（GMT、带毫秒）、消息级别、消息内容。

## 分布式日志收集服务端

其具备日志收集和日志简单查询功能。其服务端口为 8320

logging：

1）使用ConcurrentHashMap保存信息，key为服务名，value为一个list，为传过来的日志信息封装的对象类

2）与现有的日志信息进行判断，如果除了时间外完全相同，则不再进行保存

2）如果该服务未存过日志，则需要新建一个list进行日志存储

3）如果该服务名包含的没有此实例，将该实例添加进去

list

1）将map中的元素全部按logId倒序排序

2）如果没有带参数，输出全部的数据

3）如果带参数，则列表中的数据按服务名过滤，此列表默认显示最后的5条记录

